<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vector Addition Scratch Reveal</title>

<style>
  body{
    font-family: Arial, sans-serif;
    background:#f4f6fb;
    margin:0;
    padding:0;
  }

  /* ===== LOCK SCREEN ===== */
  #lockScreen{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:#111;
    color:#fff;
    padding:24px;
    text-align:center;
  }
  #lockScreen h2{ margin:0 0 14px; }
  #lockScreen p{ margin:0 0 16px; color:#ddd; }

  #passInput{
    padding:10px 12px;
    font-size:18px;
    border-radius:8px;
    border:none;
    width:160px;
    text-align:center;
    outline:none;
  }

  #unlockBtn{
    margin-top:12px;
    padding:10px 16px;
    font-weight:800;
    border:none;
    border-radius:8px;
    cursor:pointer;
  }

  #errorMsg{
    margin-top:10px;
    color:#ff4d4d;
    font-weight:800;
    min-height: 18px;
  }

  /* ===== APP ===== */
  #appContainer{
    display:none;
    padding:20px;
  }

  h2{ margin:0 0 14px; }

  .card{
    background:#fff;
    padding:20px;
    margin-bottom:18px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
  }

  .vec{
    display:inline-flex;
    align-items:center;
    font-size:20px;
    font-weight:800;
  }
  .lb,.rb{
    font-size:32px;
    margin:0 5px;
    line-height:1;
  }
  .col{
    display:grid;
    gap:4px;
    text-align:center;
    line-height:1.05;
    min-width:22px;
  }

  /* Scratch box: answer behind, canvas on top */
  .scratchWrap{
    position:relative;
    height:190px;
    margin-top:10px;
    border-radius:12px;
    overflow:hidden;
    border:1px solid #e6e6ee;
    background:#fff;
  }

  .answer{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    font-weight:900;
    z-index:1;
  }

  canvas{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    z-index:2;
    touch-action:none;
    display:block;
  }

  .controls{
    margin-top:10px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }

  button{
    border:0;
    background:#111;
    color:#fff;
    padding:10px 14px;
    border-radius:8px;
    font-weight:800;
    cursor:pointer;
  }

  .note{
    font-size:12px;
    color:#444;
  }
</style>
</head>

<body>

<!-- LOCK SCREEN -->
<div id="lockScreen">
  <h2>Enter Passcode to Start</h2>
  <p>Key in the passcode to unlock the activity.</p>
  <input type="password" id="passInput" placeholder="Passcode" inputmode="numeric">
  <button id="unlockBtn">Unlock</button>
  <div id="errorMsg"></div>
</div>

<!-- APP -->
<div id="appContainer">
  <h2>Vector Addition Scratch Reveal</h2>
  <div id="app"></div>
</div>

<script>
/* =======================
   PASSCODE GATE
======================= */
const PASSCODE = "21";

document.getElementById("unlockBtn").addEventListener("click", checkPass);
document.getElementById("passInput").addEventListener("keydown", (e)=>{
  if(e.key === "Enter") checkPass();
});

let appInitialized = false;

function checkPass(){
  const input = document.getElementById("passInput").value.trim();
  const error = document.getElementById("errorMsg");
  error.textContent = "";

  if(input === PASSCODE){
    document.getElementById("lockScreen").style.display = "none";
    document.getElementById("appContainer").style.display = "block";

    // IMPORTANT: build the app only after container is visible
    if(!appInitialized){
      initApp();
      appInitialized = true;
    }
  } else {
    error.textContent = "Try again.";
  }
}

/* =======================
   VECTOR SCRATCH APP
======================= */

// Question 3 includes negative components (variation)
const QUESTIONS = [
  { title:"Question 1", a:[3,2],  b:[4,1]  },
  { title:"Question 2", a:[5,3],  b:[2,6]  },
  { title:"Question 3", a:[-1,5], b:[3,-2] }
];

function vecHTML(x,y){
  return `
    <span class="vec">
      <span class="lb">[</span>
      <span class="col">
        <span>${x}</span>
        <span>${y}</span>
      </span>
      <span class="rb">]</span>
    </span>
  `;
}

function add(v1,v2){ return [v1[0]+v2[0], v1[1]+v2[1]]; }

const controllers = []; // store per-question reset functions

function initApp(){
  const app = document.getElementById("app");
  app.innerHTML = "";          // clean build
  controllers.length = 0;

  QUESTIONS.forEach((q,i)=>{
    const ans = add(q.a,q.b);

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3 style="margin:0 0 8px;">${q.title}</h3>
      <p style="margin:0;">
        Let a = ${vecHTML(q.a[0],q.a[1])} and b = ${vecHTML(q.b[0],q.b[1])}. Find <b>a + b</b>.
      </p>

      <div class="scratchWrap" id="wrap-${i}">
        <div class="answer">${vecHTML(ans[0],ans[1])}</div>
        <canvas id="c${i}"></canvas>
      </div>

      <div class="controls">
        <button id="reset-${i}">Reset Scratch</button>
        <span class="note">Scratch the grey layer to reveal the answer (touch-friendly).</span>
      </div>
    `;

    app.appendChild(card);

    const canvas = card.querySelector(`#c${i}`);
    const wrap = card.querySelector(`#wrap-${i}`);

    const controller = setupScratch(canvas, wrap);
    controllers.push(controller);

    card.querySelector(`#reset-${i}`).addEventListener("click", controller.reset);
  });
}

// Scratch engine (paint overlay, erase on drag)
function setupScratch(canvas, container){
  const ctx = canvas.getContext("2d");
  let isDown = false;
  const RADIUS = 22;

  function resizeAndPaint(){
    const rect = container.getBoundingClientRect();
    canvas.width  = Math.max(1, Math.floor(rect.width));
    canvas.height = Math.max(1, Math.floor(rect.height));
    reset();
  }

  function reset(){
    // paint overlay
    ctx.globalCompositeOperation = "source-over";
    ctx.fillStyle = "#b9bcc6";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // subtle texture
    ctx.strokeStyle = "rgba(255,255,255,0.18)";
    ctx.lineWidth = 1;
    for(let y=12; y<canvas.height; y+=14){
      ctx.beginPath();
      ctx.moveTo(0,y);
      ctx.lineTo(canvas.width,y);
      ctx.stroke();
    }

    // instruction
    ctx.fillStyle = "rgba(0,0,0,0.55)";
    ctx.font = "800 16px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Scratch to reveal", canvas.width/2, canvas.height/2);

    // erase mode
    ctx.globalCompositeOperation = "destination-out";
  }

  function getPos(e){
    const r = canvas.getBoundingClientRect();
    if(e.touches && e.touches[0]){
      return { x: e.touches[0].clientX - r.left, y: e.touches[0].clientY - r.top };
    }
    return { x: e.clientX - r.left, y: e.clientY - r.top };
  }

  function scratchAt(x,y){
    ctx.beginPath();
    ctx.arc(x,y,RADIUS,0,Math.PI*2);
    ctx.fill();
  }

  function onDown(e){
    e.preventDefault();
    isDown = true;
    const p = getPos(e);
    scratchAt(p.x,p.y);
  }

  function onMove(e){
    if(!isDown) return;
    e.preventDefault();
    const p = getPos(e);
    scratchAt(p.x,p.y);
  }

  function onUp(){ isDown = false; }

  canvas.addEventListener("mousedown", onDown);
  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onUp);

  canvas.addEventListener("touchstart", onDown, { passive:false });
  canvas.addEventListener("touchmove", onMove, { passive:false });
  canvas.addEventListener("touchend", onUp);

  // Keep canvas correct on resize
  const ro = new ResizeObserver(resizeAndPaint);
  ro.observe(container);

  // initial paint (container is visible when called)
  setTimeout(resizeAndPaint, 0);

  return { reset };
}
</script>

</body>
</html>